# 关于本地记录服务器原理

相关配置项: `codingTracker.localServerMode` 下文简称`localServerMode`

`localServerMode`用于无需记录多台计算机编程记录的情况下使用.
(将一个`vscode-coding-tracker-server`程序伴随VSCode启动)

本地记录服务器一台计算机只会有一个, 是随着VSCode窗口打开而启动的.
如果有多个VSCode窗口打开, 后开来打开的窗口会先调用`ajax/kill`接口杀掉之前的本地记录服务器.
然后在运行一个新的本地记录服务器. 

然后如果在多个窗口的情况下, 启动有本地记录服务器的窗口被关闭了(意味着本地记录服务器被关闭了).
别的窗口就没法继续上传编程记录信息了. 所以此时, 收个发现无法上传记录信息的窗口在`localServerMode==true`的情况下,
会重新运行一个新的本地记录服务器以保证本地记录服务器的正常延续与运作

## 当一个VSCode窗口打开时:

`localServerMode != true` 忽略掉, 因为用户关闭了本地记录服务器模式, 数据上传到远端, 不归本地程序管理

1. 调用`http://127.0.0.1:${port}/ajax/kill`接口杀掉正在运行的本地记录服务器(如果存在)
2. 创建一个新的本地记录服务器

## 当VSCode配置改变时

检查当前窗口下时候运行着本地记录服务器, 如果有, 就检查相关配置项目是否改变, 若改变则提示用户重新启动VSCode

## 当VSCode关闭时

如果存在, 就关闭当前窗口运行着的本地记录服务器

## 当插件中的所有上传队列上传完时

请求接口`/`来获取当前记录服务器时候为本地记录服务器, 并更新状态栏Local信息

## 当插件中出现上传记录失败时(由于网络因素导致时)

`localServerMode == true` 时, 试图创建运行新的本地记录服务器于当前窗口下(因为可能是别的窗口关闭后导致本地记录服务器被关闭)